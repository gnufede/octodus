{#% set page_title = current_user.name +' '+current_user.surname %#}

{% extends "layout.html" %}

{% block menu %}
<div class="span3">	
<div class="well" style="padding: 8px 0;">
<ul class="nav nav-list">
{% if current_user.is_admin() %}
    <li class='nav-header'>
    <i class='icon-user'></i>
    Usuarios
    </li>
    <li id='user_list'><a href='{{ url_for('user.list') }}'>
    <i class='icon-list'></i>
    Lista de usuarios
    </a>
    </li>
    <li class="divider"></li>
{% endif %}
<li id="inbox"> <a href='Inbox'>
        <i class='icon-inbox' style="display:inline-block;"></i>
        <div class='project draggable'  style="display:inline-block;">
        Inbox
        </div>
        {% for project in current_user.projects: %}
        {% if project.name in ['Inbox'] %}
            {% if project.get_undone_tasks() > 0 %}
            <div class='project draggable badge' style="display:inline-block;">
            {{project.get_undone_tasks()}}
            </div>
            {% endif%}
        {% endif%}
        {% endfor %}
        </a> 
        </li>
        <li id="private"><a href='Private'>
        <i class='icon-user' style="display:inline-block;"></i>
        <div class='project draggable' style="display:inline-block;">
        Private
        </div>
        {% for project in current_user.projects: %}
        {% if project.name in ['Private'] %}
            {% if project.get_undone_tasks() > 0 %}
            <div class='project draggable badge' style="display:inline-block;">
            {{project.get_undone_tasks()}}
            </div>
            {% endif%}
        {% endif%}
        {% endfor %}
        </a> 
        </li>
        <li id="public"><a href='Public'>
        <i class='icon-bullhorn' style="display:inline-block;"></i>
        <div class='project draggable' style="display:inline-block;">
        Public
        </div>
        {% for project in current_user.projects: %}
        {% if project.name in ['Public'] %}
            {% if project.get_undone_tasks() > 0 %}
            <div class='project draggable badge' style="display:inline-block;">
            {{project.get_undone_tasks()}}
            </div>
            {% endif%}
        {% endif%}
        {% endfor %}
        </a> 
        </li>
        <li id="done"><a href='Done'>
        <i class='icon-check' style="display:inline-block;"></i>
        <div class='project draggable' style="display:inline-block;">
        Done
        </div>
        </a> 
        </li>
        <li id="new_project" onClick="document.getElementById('newproject').focus();">
        <a>
        <i class='icon-plus' style="display:inline-block;"></i>
        <div id='newproject' style="display:inline-block;" 
            contenteditable onKeyPress="return _onKeyPress();" 
            onKeyDown="return _onKeyDown();" onKeyUp="return _onKeyUp($(this), 
            '/user/project/');"
            onFocus="$(this).text('');"
            onBlur="return _onBlur($(this), 'Nuevo Projecto');">
        Nuevo Proyecto
        </div> 
        </a>
        </li>
    {% if current_user.projects|length %}
    {% for project in current_user.projects: %}
    {% if project.name not in ['Inbox','Private','Public'] %}
        <li id="{{project.name}}"><a href='{{project.name}}'>
            <i class='icon-tag' style="display:inline-block;"></i>
            <div class='project draggable' style="display:inline-block;">
            {{project.name}}
            </div>
            {% if project.get_undone_tasks() > 0 %}
            <div class='project draggable badge' style="display:inline-block;">
            {{project.get_undone_tasks()}}
            </div>
            {% endif%}
            </a> 
            </li>
    {% endif %}
        {% endfor %}
    {% endif %}
    </a> 
	</li>
</ul>
{% if current_user.is_coordinator() %}
<ul class="nav nav-list">
	<li><a href='{{ url_for('frontend.edit_proceso') }}'>Editar Proceso</a> 
	</li>
</ul>
{% endif %}	
</div>
</div>
{% endblock %}
{% block body %}
{% endblock %}

{% block append_js2 %}
<script>
    $('.active a i').addClass('icon-white');
    function show()
    {
    alert(editor.innerHTML);
    }

    function checkEnter() {
        if (window.event.keyCode == 13) { 
            window.event.cancelBubble = true;
            return false;
        }
        else return true;
        }

    function _onBlur(node, defaultText)
    {
        node.text(defaultText);
        return true;
    }

    function _onKeyDown()
    {
        return checkEnter();
    }

    function _onKeyUp(node, url)
    {
        if (window.event.keyCode == 13) { 
            var sel = node.text();
            sel = decodeURIComponent(sel);
            sel=sel.replace(/^\s\s*/, '').replace(/\s\s*$/, '').replace(/ /g,"_");
            window.location.href=url+sel
            //sel.pasteHTML('<br>'); 
            //sel.moveEnd();
        }
        return true;
    }

    function _onKeyPress()
    { 
        return checkEnter();
    }
</script>
{% endblock %}
